# Программы для работы с файлами котировок

Текущая версия xqhtools 1.7

## xqhtools.exe

*xqhtools.exe* - консольная программа для конвертации и слияния файлов котировок. 
Данная программа собрана при помощи компилятора *MinGW-w64* версии *7.3.0* [https://sourceforge.net/projects/mingw-w64/](https://sourceforge.net/projects/mingw-w64/)
Если на вашем компьютере нет необходимых dll файлов, их можно взять из архива с компилятором.

Команды:

* *train* - обучить алгоритм сжатия zstd на конкретном наборе данных. Данная команда необходима для создания словаря.
* *merge* - (Не реализовано полностью) слить файлы котировок или файлы каких либо данных вместе. Пока данная команда работает только с хранилищем Storage и может суммировать подфайлы.
* *convert_csv* - конвертировать csv файлы. Данная команда подходит для конвертации csv файлов в набор hex файлов или в хранилище котировок qhs*
* *convert_storage* - конвертировать qhs* файлы. Данная команда конвертирует файлы qhs* в csv файлы
* *date* - узнать минимальную и максимальную дату котировок файла хранилища
* *version* - версия программы
* *subfile_crc64* - crc64 подфайла (требует указать также data и на выбор path_storage или path_raw_storage)

Переменные:

* *path_hex* - путь к папке с файлами hex
* *path_csv* - путь к файлу котировок в формате csv
* *path_storage* - путь к файлу котировок в формате хранилища котировок qhs*
* *header* - заголовок csv файла (переменная нужна только для преобразования qhs* файлов в csv)
* *path_dictionary* - путь к файлу словаря. Директория должна существовать! (переменная нужна только для команды train)
* *dictionary_name* - имя словаря (переменная нужна только для команды train)
* *path_raw_storage* - путь к хранилищу с данными для обучения алгоритма сжатия (переменная нужна только для команды train)
* *path_raw* - путь к файлам-образцам для обучения алгоритма сжатия (переменная нужна только для команды train)
* *fill_factor* - уровень заполнения от 1 до 100. Переменная нужна для уменьшения количества образцов из выборки для обучения алгоритма сжатия (переменная нужна только для команды train)
* *dictionary_capacity* - размер словарья, по умолчанию 102400 (переменная нужна только для команды train)
* *paths_raw_storages* - файлы хранилищ с данными, колторые нужно слить в одно хранилище (переменная нужна только для команды merge) 
* *path_out_raw_storage* - файл хранилища, куда будут помещены все подфайлы во время слияния (переменная нужна только для команды merge) 

Флаги:

* *-cetgmt* - преобразовать время CET в GMT
* *-eetgmt* - преобразовать время EET в GMT
* *-mskgmt* - преобразовать время MSK в GMT
* *-gmtcet* - преобразовать время GMT в CET
* *-gmteet* - преобразовать время GMT в EET
* *-gmtmsk* - преобразовать время GMT в MSK
* *-finam* - преобразовать время CET в GMT при конвертировании csv файлов 
* *-alpari* - преобразовать время EET в GMT или CET в GMT при конвертировании csv файлов (у ДЦ серверов Альпари с 01.05.2011 года время сервера поменялось с CET на EET)
* *-h* - прочитать заголовок csv файла. Не оказывает влияния
* *-oo* - использовать только цену открытия (open) бара или свечи. 
* *-oc* - использовать только цену закрытия (close) бара или свечи. 
* *-ohlc* - использовать 4 цены бара или свечи (open, high, low, close)
* *-ohlcv* - использовать 4 цены бара или свечи (open, high, low, close) и объем (volume)
* *-c* - использовать сжатие данных (только для преобразования csv в формат хранилища котировок qhs* или для слияния qhs* файлов)
* *-m4* - использовать преобразование qhs* файлов в csv формат для MetaTrader4
* *-m5* - использовать преобразование qhs* файлов в csv формат для MetaTrader5
* *-ducascopy* - использовать преобразование qhs* файлов в csv формат брокера Ducascopy
* *-sbc* - пропускать "плохие" бары во время преобразования qhs* файлов в csv. Плохие бары, это когда отсутствует цена за данную минуту
* *-fbc* - заполнять "плохие" бары во время преобразования qhs* файлов в csv. Заполнение будет происходить последней известной ценой
* *-wbc* - записывать "плохие" бары во время преобразования qhs* файлов в csv
* *-rnd* - перемешать в случайном порядке образцы для обучения алгоритма сжатия (флаг нужен только для команды train)
* *-cpp* - сохранить словарь в виде С++ заголовка (флаг нужен только для команды train)

### Пример использования

Преобразовать csv файл в qhs4 файл с использованием сжатия (флаг *-c*) и преобразованием времени из CET в GMT (флаг *-ohlc*):

```
xqhtools convert_csv path_storage ..\storage\AUDCAD path_csv ..\csv\AUDCAD1.csv -cetgmt -ohlc -c
```

Преобразовать qhs4 файл обратно в csv файл для MetaTrader4 с преобразованием GMT времени в CET (флаг *-gmtcet*) и пропуском плохих баров (*-sbc*)

```
xqhtools convert_storage path_storage ..\storage\AUDCAD.qhs4 path_csv ..\csv\AUDCAD1.csv -gmtcet -m4 -sbc
```

Обучить алгоритм сжатия на образцах в хранилище данных и получить на выходе словарь *test_dictionary.hpp*, имя словаря *dict_test*. Перемешать образы для обучения в случайном порядке и затем использовать только 50% случайных образцов. Установить размер словаря *102400* байт.

```
xqhtools.exe train path_raw_storage "../storage/EURJPY.qhs4" path_dictionary "test_dictionary.hpp" dictionary_name "dict_test" fill_factor 50 dictionary_capacity 102400 -rnd -cpp
```

